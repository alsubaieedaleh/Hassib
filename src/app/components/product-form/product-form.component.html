<!-- ðŸŒŸ PRODUCT FORMS SECTION -->
<div class="form-section w-full max-w-screen-lg mx-auto px-4">
  <header class="flex flex-col gap-1 mb-4">
    <span class="section-eyebrow">Products</span>
    <h2 class="text-2xl font-semibold text-slate-800">Product entries</h2>
    <p class="text-sm text-slate-500 max-w-2xl">
      Enter product details, costs and sale prices. Additional rows can be added instantly and reused across pages.
    </p>
  </header>

  @for (form of productForms(); track $index) {
    <ui-card class="form-card" uiCardVariant="surface" [uiCardInteractive]="false">
      @if (productForms().length > 1) {
        <button
          type="button"
          class="form-card__remove"
          uiButton="ghost"
          uiButtonSize="sm"
          (click)="removeProduct($index)"
          aria-label="Remove product"
        >
          <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M18 6L6 18" stroke-linecap="round" />
            <path d="M6 6l12 12" stroke-linecap="round" />
          </svg>
        </button>
      }

      <div class="form-grid">
        @for (field of productFields; track field.key) {
          <div class="form-field">
            <label class="form-label">{{ field.label }}</label>
            <input
              [type]="field.type"
              uiInput
              [attr.placeholder]="field.placeholder"
              [value]="field.getter(form)"
              [step]="field.step"
              [min]="field.min"
              (input)="field.onInput(form, $event)"
            />
          </div>
        }
      </div>
    </ui-card>
  }

  <button type="button" class="link-button" uiButton="ghost" uiButtonSize="sm" (click)="addProduct()">
    <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor">
      <path d="M12 5v14M5 12h14" />
    </svg>
    Add another product
  </button>

  <ui-card class="form-card mt-4" uiCardVariant="surface" [uiCardInteractive]="false">
    <div class="flex items-center gap-3 mb-4">
      <span class="badge">Sale details</span>
      <p class="text-sm text-slate-500">Contextual information for receipts and exports.</p>
    </div>

    <div class="form-grid form-grid--meta">
      @if (showLocation()) {
        <div class="form-field">
          <label class="form-label">Storage location</label>
          <div class="flex items-center gap-2">
            <select
              uiInput
              [value]="locationId() ?? ''"
              (change)="onLocationChange($event)"
            >
              @if (!locationOptions().length) {
                <option value="">No locations available</option>
              } @else {
                @for (loc of locationOptions(); track loc.id) {
                  <option [value]="loc.id">{{ loc.name }}</option>
                }
              }
            </select>
            <button type="button" uiButton="ghost" uiButtonSize="sm" (click)="createLocation()">
              Add
            </button>
          </div>
          @if (locationLoading()) {
            <p class="helper">Loading locationsâ€¦</p>
          }
          @if (locationError()) {
            <p class="helper error">{{ locationError() }}</p>
          }
        </div>
      }

      @if (showVAT()) {
        <div class="form-field">
          <label class="form-label">VAT (%)</label>
          <input
            type="number"
            readonly
            uiInput
            placeholder="VAT Rate"
            [value]="fixedVATRate()"
          />
        </div>
      }

      @if (showPayment()) {
        <div class="form-field">
          <label class="form-label">Payment type</label>
          <select
            uiInput
            [value]="payment()"
            (change)="onPaymentChange($event)"
          >
            @for (opt of paymentOptions; track opt) {
              <option [value]="opt">{{ opt }}</option>
            }
          </select>
        </div>
      }

      @if (showPhone()) {
        <div class="form-field">
          <label class="form-label">Customer phone</label>
          <input
            type="text"
            uiInput
            placeholder="Customer phone"
            [value]="phone()"
            (input)="onPhoneInput($event)"
          />
        </div>
      }
    </div>
  </ui-card>

  <div class="form-actions mt-6">
    <button type="button" uiButton="primary" (click)="submit()">
      <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor">
        <path d="M5 13l4 4L19 7" />
      </svg>
      {{ submitLabel() }}
    </button>

    <button type="button" uiButton="ghost" (click)="clear()">
      <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor">
        <path d="M3 6h18M9 6v12M15 6v12" />
      </svg>
      Clear
    </button>
  </div>
</div>
